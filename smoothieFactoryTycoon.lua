local player = game.Players.LocalPlayer
local playerName = player.Name
local _, library = pcall(loadstring(game:HttpGet("https://raw.githubusercontent.com/TrixAde/Osmium/main/OsmiumLibrary.lua")))
local window = library:CreateWindow("Smoothie Factory Tycoon GUI")
local mainTab = window:CreateTab("Main")
local tpTab = window:CreateTab("Tp")

local autoObbytask = nil
local autoMoonObbytask = nil

-- get local tycoon
-- local myTycoon = nil

-- local tycoonFolder = game.Workspace:FindFirstChild("Tycoons")

-- for _, tycoon in ipairs(tycoonFolder:GetChildren()) do
--     if tostring(tycoon.Owner.Value) == playerName then
--         myTycoon = tycoon
--     end
-- end


-- util functions
local function getLocalBase()
    local tycoonFolder = game.Workspace:FindFirstChild("Tycoons")
    for _, tycoon in ipairs(tycoonFolder:GetChildren()) do
        if tostring(tycoon.Owner.Value) == playerName then
            return tycoon
        end
    end
end

-- btn callbacks
local function tpEasy()
    local currentLocation = player.Character.HumanoidRootPart.CFrame
    local destination = workspace.Obbies.EasyObby.Finish.Button.CFrame
    player.Character:MoveTo(destination.Position)
    wait(0.5)
    player.Character:MoveTo(currentLocation.Position)
end
local function tpMoonFinish()
    local currentLocation = player.Character.HumanoidRootPart.CFrame
    local destination = workspace.Obbies.GravityTowerObby.Finish.Button.CFrame
    player.Character:MoveTo(destination.Position)
    wait(0.5)
    player.Character:MoveTo(currentLocation.Position)
end

local function tpHard()
    local currentLocation = player.Character.HumanoidRootPart.CFrame
    local destination = workspace.Obbies.HardObby.Finish.Button.CFrame
    player.Character:MoveTo(destination.Position)
    wait(0.5)
    player.Character:MoveTo(currentLocation.Position)
end
local function tpMoonBase()
    local tycoon = getLocalBase()
    local destination = tycoon.ExtraTycoons.MoonTycoon.Tycoon.BlenderRoom.Stairs.StairSet.Ramp.CFrame
    player.Character:MoveTo(destination.Position)
end
local function tpEarthBase()
    local tycoon = getLocalBase()
    local destination = tycoon.TycoonGate.LeftPole.CFrame
    player.Character:MoveTo(destination.Position)
end

local function localObjRemoval()
    local tycoon = getLocalBase()
    if tycoon.Foliage:FindFirstChild('Trees') then
        tycoon.Foliage['Trees']:Destroy()
    end
    if tycoon.BasementEntrance:FindFirstChild("Decor") then
        tycoon.BasementEntrance["Decor"]:Destroy()
    end
    for _, child in ipairs(tycoon.Factory.Factory:GetChildren()) do
        if child.Name ~= "Foundation" and child.Name ~= "Wedge" and child.Name ~= "BackWall" then
            child:Destroy()
        end
    end
    for _, child in ipairs(tycoon.Factory.Factory.BackWall:GetChildren()) do
        local success, material = pcall(function() return child.Material end)
        if success and material == Enum.Material.Brick then
            child:Destroy()
        end
        if child.Name == "FrontShutter" then
            child:Destroy()
        end
    end

    -- moon walls
    if tycoon.ExtraTycoons.MoonTycoon.Tycoon.BlenderRoom:FindFirstChild('Walls') then
        tycoon.ExtraTycoons.MoonTycoon.Tycoon.BlenderRoom['Walls']:Destroy()
    end
    
    -- static
    if tycoon:FindFirstChild('AutoBlendSign') then
        tycoon['AutoBlendSign']:Destroy()
    end
    if tycoon:FindFirstChild('AutoBlendSign') then
        tycoon['AutoBlendSign']:Destroy()
    end
    if tycoon:FindFirstChild('TycoonWalls') then
        tycoon['TycoonWalls']:Destroy()
    end

    if tycoon.PurchaseButtons:FindFirstChild("Toggle Door Gamepass") then
        tycoon.PurchaseButtons["Toggle Door Gamepass"]:Destroy()
    end
    if tycoon.PurchaseButtons:FindFirstChild("Gold Blender") then
        tycoon.PurchaseButtons["Gold Blender"]:Destroy()
    end
    
    for i = 1, 3 do
        if tycoon.PurchaseButtons:FindFirstChild("Gold Dropper " .. i) then
            tycoon.PurchaseButtons["Gold Dropper " .. i]:Destroy()
        end
    end
    if tycoon.PurchaseButtons:FindFirstChild("Rainbow Upgrader") then
        tycoon.PurchaseButtons["Rainbow Upgrader"]:Destroy()
    end
    if tycoon.PurchaseButtons:FindFirstChild("Rainbow Gem Upgrader") then
        tycoon.PurchaseButtons["Rainbow Gem Upgrader"]:Destroy()
    end
    if tycoon.PurchaseButtons:FindFirstChild("Rainbow UFO Upgrader") then
        tycoon.PurchaseButtons["Rainbow UFO Upgrader"]:Destroy()
    end
    if tycoon.ProcessingMachines.JarFactory.JarFactory:FindFirstChild("DoorEntry") then
        tycoon.ProcessingMachines.JarFactory.JarFactory["DoorEntry"]:Destroy()
    end
    if tycoon.ProcessingMachines.JarFactory.JarFactory2:FindFirstChild("DoorEntry") then
        tycoon.ProcessingMachines.JarFactory.JarFactory2["DoorEntry"]:Destroy()
    end
    if tycoon.ProcessingMachines.JarFactory.MoonJarFactory1:FindFirstChild("DoorEntry") then
        tycoon.ProcessingMachines.JarFactory.MoonJarFactory1["DoorEntry"]:Destroy()
    end
    if tycoon.ProcessingMachines.JarFactory.MoonJarFactory2:FindFirstChild("DoorEntry") then
        tycoon.ProcessingMachines.JarFactory.MoonJarFactory2["DoorEntry"]:Destroy()
    end
    if tycoon.PurchaseButtons:FindFirstChild("Toggle Door Gamepass 2") then
        tycoon.PurchaseButtons["Toggle Door Gamepass 2"]:Destroy()
    end
    if tycoon.PurchaseButtons:FindFirstChild("Toggle Door Gamepass 3") then
        tycoon.PurchaseButtons["Toggle Door Gamepass 3"]:Destroy()
    end
    if tycoon.PurchaseButtons:FindFirstChild("Toggle Door Gamepass 4") then
        tycoon.PurchaseButtons["Toggle Door Gamepass 4"]:Destroy()
    end
   
    -- clean up rocks
    for _, child in ipairs(tycoon.Foliage:GetChildren()) do
        if child.Name == "MeshPart" or child.Name == "Bucket" then
            child:Destroy()
        end
    end
    if tycoon.Foliage:FindFirstChild("Grass Platform 4") then
        tycoon.Foliage["Grass Platform 4"]:Destroy()
    end
    -- basement trusses
    if tycoon.BasementDecor:FindFirstChild("Trusses") then
        tycoon.BasementDecor["Trusses"]:Destroy()
    end
end

local rTreeBtn = mainTab:CreateButton("Remove Trees", function()
    if workspace.AreaDecor:FindFirstChild('GreenTrees') then
        workspace.AreaDecor['GreenTrees']:Destroy()
    end
end)

local rFactory = mainTab:CreateButton("Remove Factory Objects", localObjRemoval)

local infYieldBtn = mainTab:CreateButton("Infinite Yield", function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
end)

local autoMoonObbyToggle = mainTab:CreateToggle("AutoMoonObby", false, function (taskRunning)
    if not taskRunning then
        task.cancel(autoMoonObbytask)
        autoMoonObbytask = nil
        print("Task stopped (moon)")
    else
        autoMoonObbytask = task.spawn(function()
            while wait(1) and taskRunning do
                local moonObbyOpen = not workspace.Obbies.GravityTowerObby.Decorations.ObbySign.Border.CanCollide
                if moonObbyOpen then
                    tpMoonFinish()
                end;
            end
        end)
        print("Task started (moon)")
    end
end)
local autoObbyToggle = mainTab:CreateToggle("AutoDefaultObby", false, function (taskRunning)
    if not taskRunning then
        task.cancel(autoObbytask)
        autoObbytask = nil
        print("Task stopped")
    else
        autoObbytask = task.spawn(function()
            while wait(1) and taskRunning do
                local easyObbyOpen = not workspace.Obbies.EasyObby.Decorations.ObbySign.Border.CanCollide
                local hardObbyOpen = not workspace.Obbies.HardObby.Decorations.ObbySign.Border.CanCollide
                if easyObbyOpen then
                    tpEasy()
                end;
                if hardObbyOpen then
                    tpHard()
                end
            end
        end)
        print("Task started")
    end
end)

local tpMoonBtn = tpTab:CreateButton("Tp to Moon", tpMoonBase)
local tpEarthBtn = tpTab:CreateButton("Tp to Earth", tpEarthBase)
